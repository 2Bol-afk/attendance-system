{% extends 'base_parent.html' %}
{% load static %}

{% block title %}Child Attendance Summary{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/report.css' %}">

<div class="dashboard-container">

  <!-- Header -->
  <div class="dashboard-header">
    <h2>Child Attendance Summary</h2>
  </div>

  <!-- Filter Form -->
  <form method="get" class="filter-form">

    <!-- Child Dropdown (hide in backend if parent has only 1 child) -->
    {% if children|length > 1 %}
    <div class="form-group">
      <label>Child</label>
      <select name="child">
        {% for child in children %}
          <option value="{{ child.student_ID }}"
            {% if selected_child == child.student_ID %}selected{% endif %}>
            {{ child.full_name }} ({{ child.student_ID }})
          </option>
        {% endfor %}
      </select>
    </div>
    {% endif %}

    <!-- Subject Filter -->
    <div class="form-group">
      <label>Subject</label>
      <select name="subject">
        <option value="">All Subjects</option>
        {% for subj in subjects %}
          <option value="{{ subj.id }}"
            {% if selected_subject == subj.id|stringformat:"s" %}selected{% endif %}>
            {{ subj.subject_code }} - {{ subj.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Filter Button -->
    <div class="form-group filter-button">
      <button type="submit" class="add-student-btn">Filter</button>
    </div>

  </form>

  <!-- Stats Summary -->
  <div class="student-list-box">
      <div class="student-card">
        <h3>Present</h3>
        <p><strong>{{ total_present }}</strong></p>
      </div>

      <div class="student-card">
        <h3>Absent</h3>
        <p><strong>{{ total_absent }}</strong></p>
      </div>

      <div class="student-card">
        <h3>Late</h3>
        <p><strong>{{ total_late }}</strong></p>
      </div>

      <div class="student-card">
        <h3>Overall Attendance %</h3>
        <p><strong>{{ attendance_percent }}%</strong></p>
      </div>
  </div>

  <!-- ---- Recent Attendance Table ---- -->
  <div class="attendance-box" style="margin-top: 25px;">
    <h3 style="margin-bottom: 12px;">Recent Attendance</h3>
    
    <table class="report-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Subject</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for item in recent_attendance %}
        <tr>
          <td>{{ item.date }}</td>
          <td>{{ item.subject }}</td>
          <td class="{% if item.status == 'present' %}present{% elif item.status == 'absent' %}absent{% else %}late{% endif %}">
            {{ item.status|capfirst }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="empty-row">No recent attendance found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- ---- Subject Breakdown ---- -->
  <div class="attendance-box" style="margin-top: 25px;">
    <h3 style="margin-bottom: 12px;">Subject Breakdown</h3>

    <table class="report-table">
      <thead>
        <tr>
          <th>Subject</th>
          <th>Present</th>
          <th>Absent</th>
          <th>Late</th>
          <th>Attendance %</th>
        </tr>
      </thead>

      <tbody>
        {% for row in subject_breakdown %}
        <tr>
          <td>{{ row.subject }}</td>
          <td>{{ row.present }}</td>
          <td>{{ row.absent }}</td>
          <td>{{ row.late }}</td>
          <td>{{ row.percent }}%</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="empty-row">No subject data available.</td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>

{% endblock %}
