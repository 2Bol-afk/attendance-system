{% extends 'teacherbase.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/report.css' %}">

<div class="dashboard-container">

  <div class="dashboard-header">
    <h2>Attendance Summary</h2>
  </div>

  <!-- Filters -->
  <form method="get" class="filter-form mb-4">
    <div class="form-group">
        <label>Semester</label>
        <select name="semester">
          <option value="">All Semesters</option>
          {% for sem in semesters %}
            <option value="{{ sem }}" {% if semester_filter == sem %}selected{% endif %}>{{ sem }}</option>
          {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Subject</label>
        <select name="subject">
          <option value="">All Subjects</option>
          {% for id, name in subjects %}
            <option value="{{ id }}" {% if subject_filter == id|stringformat:"s" %}selected{% endif %}>{{ name }}</option>
          {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Section</label>
        <select name="section">
          <option value="">All Sections</option>
          {% for value, display in sections %}
            <option value="{{ value }}" {% if section_filter == value %}selected{% endif %}>{{ display }}</option>
          {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Year</label>
        <select name="year">
          <option value="">All Years</option>
          {% for y in years %}
            <option value="{{ y }}" {% if year_filter == y %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <label>Date From</label>
        <input type="date" name="start_date" value="{{ request.GET.start_date}}" onchange="this.form.submit()">
    </div>
    <div class="form-group">
        <label>Date To</label>
        <input type="date" name="end_date" value="{{ request.GET.end_date }}" onchange="this.form.submit()" >
    </div>

    <div class="form-group filter-button">
        <button type="submit" class="add-student-btn">Filter</button>
    </div>
  </form>

  <div class="attendance-box">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Course</th>
            <th>Subject</th>
            <th>Section</th>
            <th>Total in Class</th>
            <th>Average Attendance %</th>
            <th>Present</th>
            <th>Late</th>
            <th>Absent</th>
            <th>Semester</th>
            <th>Year</th>
            <th>School Year</th>
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
          <tr>
            <td>{{ row.course }}</td>
            <td>{{ row.subject }}</td>
            <td>{{ row.section }}</td>
            <td>{{ row.total_in_class }}</td>
            <td>{{ row.avg_attendance }}%</td>
            <td>{{ row.present }}</td>
            <td>{{ row.late }}</td>
            <td>{{ row.absent }}</td>
            <td>{{ row.semester }}</td>
            <td>{{ row.year }}</td>
            <td>{{ row.school_year }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="11">No data found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
  </div>

</div>
{% endblock %}
