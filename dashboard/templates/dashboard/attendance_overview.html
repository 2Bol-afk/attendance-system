{% extends 'base_parent.html' %}
{% block title %}Attendance Overview{% endblock %}

{% block content %}
<div class="dashboard-container">

  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <h2>{{ student.full_name }} - Attendance Overview</h2>
  </div>

  <!-- Filters -->
  <form method="GET" class="filter-form" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
    <div>
      <label for="subject">Subject:</label>
      <select name="subject" id="subject">
        <option value="">-- All Subjects --</option>
        {% for subject in subjects %}
        <option value="{{ subject.id }}" {% if selected_subject and selected_subject.id == subject.id %}selected{% endif %}>
          {{ subject.name }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="start_date">Start Date:</label>
      <input type="date" id="start_date" name="start_date" value="{{ start_date }}">
    </div>

    <div>
      <label for="end_date">End Date:</label>
      <input type="date" id="end_date" name="end_date" value="{{ end_date }}">
    </div>

    <div style="align-self: flex-end;">
      <button type="submit" class="add-student-btn">View</button>
    </div>
  </form>

  <!-- Attendance Table -->
  <div class="attendance-box">
    <table class="recent-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Time</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for record in attendance_records %}
        <tr>
          <td>{{ record.date|date:"M d, Y" }}</td>
          <td>{{ record.time|time:"H:i" }}</td>
          <td>
            <span class="status-label 
              {% if record.status == 'present' %}present
              {% elif record.status == 'absent' %}absent
              {% else %}late{% endif %}">
              {{ record.status|title }}
            </span>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="empty-row">No attendance records found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
<style>
/* Container fix */
.filter-form label {
  font-weight: 600;
  font-size: 14px;
  margin-bottom: 5px;
  display: block;
}

/* Dropdown styling */
.filter-form select,
.filter-form input[type="date"] {
  padding: 8px 12px;
  width: 180px;
  border: 1px solid #d1d5db;  /* light gray */
  border-radius: 6px;
  background-color: #fff;
  font-size: 14px;
  outline: none;
  transition: all 0.2s ease;
}

/* Hover */
.filter-form select:hover,
.filter-form input[type="date"]:hover {
  border-color: #9ca3af; /* darker gray */
}

/* Focus */
.filter-form select:focus,
.filter-form input[type="date"]:focus {
  border-color: #2563eb; /* blue */
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
}

/* Dropdown appearance */
.filter-form select {
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='16' height='16' fill='gray' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M4 6l4 4 4-4z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 14px;
  padding-right: 32px; /* space for arrow */
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const startDateField = document.getElementById("start_date");
    const endDateField = document.getElementById("end_date");

    // Format today's date for input[type="date"]
    const today = new Date().toISOString().split("T")[0];

    // Only auto-fill if they are empty (meaning: first load)
    if (!startDateField.value) {
        startDateField.value = today;
    }
    if (!endDateField.value) {
        endDateField.value = today;
    }
});
</script>

{% endblock %}
